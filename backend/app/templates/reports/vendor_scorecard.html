<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <title>Scorecard Fournisseur - CyberScore</title>
  <style>
    @page { size: A4; margin: 18mm; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', Arial, sans-serif; color: #2C3E50; background: #F7F9FA; font-size: 10pt; line-height: 1.5; }

    .header { background: #1B3A5C; color: #fff; padding: 20px 28px; display: flex; align-items: center; justify-content: space-between; }
    .header .logo { font-size: 18pt; font-weight: 700; }
    .header .logo span { color: #2E75B6; }
    .header .meta { font-size: 9pt; text-align: right; opacity: 0.85; }

    .scorecard { padding: 20px 0; }

    /* Gauge */
    .gauge-section { text-align: center; padding: 24px 0; }
    .gauge-score { font-size: 64pt; font-weight: 800; }
    .gauge-label { font-size: 11pt; color: #64748B; }
    .gauge-grade { display: inline-block; font-size: 32pt; font-weight: 800; color: #fff; padding: 8px 28px; border-radius: 10px; margin-top: 12px; }

    /* Vendor info */
    .vendor-info { display: flex; gap: 20px; margin: 16px 0; padding: 16px; background: #fff; border-radius: 8px; border: 1px solid #E2E8F0; }
    .vendor-info .field { flex: 1; }
    .vendor-info .label { font-size: 8pt; color: #64748B; text-transform: uppercase; }
    .vendor-info .value { font-size: 11pt; font-weight: 600; color: #1B3A5C; }

    /* Mini bars */
    .domains { margin: 20px 0; }
    .domains-title { font-size: 12pt; font-weight: 700; color: #1B3A5C; border-bottom: 2px solid #2E75B6; padding-bottom: 6px; margin-bottom: 12px; }
    .domain-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
    .domain-label { width: 150px; font-size: 9pt; font-weight: 600; }
    .domain-bar-bg { flex: 1; height: 18px; background: #E2E8F0; border-radius: 4px; overflow: hidden; position: relative; }
    .domain-bar-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
    .domain-score-text { width: 60px; text-align: right; font-size: 9pt; font-weight: 700; }

    .bg-A { background: #27AE60; } .bg-B { background: #2ECC71; } .bg-C { background: #F39C12; } .bg-D { background: #E67E22; } .bg-F, .bg-E { background: #C0392B; }

    /* Findings */
    .findings { margin: 20px 0; }
    .findings-title { font-size: 12pt; font-weight: 700; color: #1B3A5C; border-bottom: 2px solid #2E75B6; padding-bottom: 6px; margin-bottom: 12px; }
    .finding-item { display: flex; align-items: flex-start; gap: 10px; padding: 8px 0; border-bottom: 1px solid #F1F5F9; }
    .severity-dot { width: 10px; height: 10px; border-radius: 50%; margin-top: 4px; flex-shrink: 0; }
    .dot-critical { background: #C0392B; } .dot-high { background: #E67E22; } .dot-medium { background: #F39C12; } .dot-low { background: #2ECC71; }
    .finding-text { font-size: 9pt; }

    /* Trend */
    .trend-section { margin: 16px 0; padding: 12px 16px; background: #fff; border-radius: 8px; border: 1px solid #E2E8F0; display: flex; align-items: center; gap: 16px; }
    .trend-label { font-size: 9pt; color: #64748B; }
    .trend-value { font-size: 14pt; font-weight: 700; }
    .trend-up { color: #27AE60; } .trend-down { color: #C0392B; } .trend-stable { color: #64748B; }

    /* Recommendations */
    .recs { margin: 16px 0; }
    .rec-item { background: #fff; border-left: 3px solid #2E75B6; padding: 8px 12px; margin-bottom: 6px; border-radius: 0 4px 4px 0; font-size: 9pt; }

    .footer { text-align: center; font-size: 8pt; color: #94A3B8; padding: 12px 0; border-top: 1px solid #E2E8F0; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">Cyber<span>Score</span></div>
    <div class="meta">Scorecard Fournisseur<br/>{{ generated_at }}</div>
  </div>

  <div class="scorecard">
    <div class="gauge-section">
      <div class="gauge-score" style="color: {{ grade_color }}">{{ score }}</div>
      <div class="gauge-label">Score Global (0-1000)</div>
      <div class="gauge-grade" style="background: {{ grade_color }}">{{ grade }}</div>
    </div>

    <div class="vendor-info">
      <div class="field"><div class="label">Fournisseur</div><div class="value">{{ vendor_name }}</div></div>
      <div class="field"><div class="label">Tier</div><div class="value">{{ tier }}</div></div>
      <div class="field"><div class="label">Secteur</div><div class="value">{{ sector }}</div></div>
      <div class="field"><div class="label">Derniere analyse</div><div class="value">{{ last_scan }}</div></div>
    </div>

    <div class="domains">
      <div class="domains-title">Scores par Domaine</div>
      {% for ds in domain_scores %}
      <div class="domain-row">
        <div class="domain-label">{{ ds.code }} {{ ds.name }}</div>
        <div class="domain-bar-bg"><div class="domain-bar-fill bg-{{ ds.grade }}" style="width: {{ ds.score }}%"></div></div>
        <div class="domain-score-text">{{ ds.score }}/100 ({{ ds.grade }})</div>
      </div>
      {% endfor %}
    </div>

    <div class="trend-section">
      <div><div class="trend-label">Tendance vs M-1</div><div class="trend-value {% if trend_delta >= 0 %}trend-up{% else %}trend-down{% endif %}">{% if trend_delta >= 0 %}+{% endif %}{{ trend_delta }} pts</div></div>
      <div><div class="trend-label">Direction</div><div class="trend-value {{ trend_direction }}">{{ trend_direction|upper }}</div></div>
    </div>

    <div class="findings">
      <div class="findings-title">Constats Cles</div>
      {% for f in key_findings %}
      <div class="finding-item">
        <div class="severity-dot dot-{{ f.severity }}"></div>
        <div class="finding-text"><strong>{{ f.title }}</strong> â€” {{ f.description }}</div>
      </div>
      {% endfor %}
    </div>

    <div class="recs">
      <div class="findings-title">Recommandations</div>
      {% for rec in recommendations %}
      <div class="rec-item">{{ loop.index }}. {{ rec }}</div>
      {% endfor %}
    </div>
  </div>

  <div class="footer">
    CyberScore &mdash; Scorecard genere le {{ generated_at }} &mdash; Confidentiel
  </div>
</body>
</html>
