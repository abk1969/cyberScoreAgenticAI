<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <title>Registre DORA Art.28 - CyberScore</title>
  <style>
    @page { size: A4 landscape; margin: 14mm; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', Arial, sans-serif; color: #2C3E50; background: #F7F9FA; font-size: 9pt; line-height: 1.4; }

    .header { background: #1B3A5C; color: #fff; padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; }
    .header .logo { font-size: 16pt; font-weight: 700; }
    .header .logo span { color: #2E75B6; }
    .header .meta { font-size: 8pt; text-align: right; opacity: 0.85; }

    .section { margin: 16px 0; }
    .section-title { font-size: 12pt; font-weight: 700; color: #1B3A5C; border-bottom: 3px solid #2E75B6; padding-bottom: 6px; margin-bottom: 12px; }

    table { width: 100%; border-collapse: collapse; font-size: 8pt; }
    th { background: #1B3A5C; color: #fff; padding: 6px 8px; text-align: left; font-size: 7pt; text-transform: uppercase; white-space: nowrap; }
    td { padding: 5px 8px; border-bottom: 1px solid #E2E8F0; vertical-align: top; }
    tr:nth-child(even) { background: #F7F9FA; }

    .criticality-critical { background: #C0392B; color: #fff; padding: 2px 6px; border-radius: 3px; font-size: 7pt; font-weight: 700; }
    .criticality-important { background: #E67E22; color: #fff; padding: 2px 6px; border-radius: 3px; font-size: 7pt; font-weight: 700; }
    .criticality-standard { background: #2E75B6; color: #fff; padding: 2px 6px; border-radius: 3px; font-size: 7pt; }

    .status-active { color: #27AE60; font-weight: 700; }
    .status-review { color: #F39C12; font-weight: 700; }
    .status-exit { color: #C0392B; font-weight: 700; }

    .cert-badge { display: inline-block; background: #EBF5FB; color: #2E75B6; padding: 1px 6px; border-radius: 3px; font-size: 7pt; margin: 1px 2px; }

    .summary-cards { display: flex; gap: 12px; margin: 12px 0; }
    .summary-card { flex: 1; background: #fff; border: 1px solid #E2E8F0; border-radius: 6px; padding: 12px; text-align: center; }
    .summary-card .label { font-size: 8pt; color: #64748B; text-transform: uppercase; }
    .summary-card .value { font-size: 20pt; font-weight: 700; color: #1B3A5C; }

    .footer { text-align: center; font-size: 7pt; color: #94A3B8; padding: 10px 0; border-top: 1px solid #E2E8F0; margin-top: 16px; }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">Cyber<span>Score</span></div>
    <div class="meta">Registre des accords contractuels â€” DORA Art. 28<br/>{{ generated_at }}<br/>Ref: {{ register_ref }}</div>
  </div>

  <div class="summary-cards">
    <div class="summary-card">
      <div class="label">Total Prestataires TIC</div>
      <div class="value">{{ summary.total_providers }}</div>
    </div>
    <div class="summary-card">
      <div class="label">Critiques</div>
      <div class="value" style="color: #C0392B">{{ summary.critical_count }}</div>
    </div>
    <div class="summary-card">
      <div class="label">Avec Sous-traitants</div>
      <div class="value">{{ summary.with_subcontractors }}</div>
    </div>
    <div class="summary-card">
      <div class="label">Plans de Sortie</div>
      <div class="value" style="color: #27AE60">{{ summary.with_exit_plans }}</div>
    </div>
  </div>

  <div class="section">
    <div class="section-title">Registre des Prestataires TIC (Art. 28 DORA)</div>
    <table>
      <thead>
        <tr>
          <th>Prestataire TIC</th>
          <th>Fonction TIC</th>
          <th>Criticite</th>
          <th>Date Debut</th>
          <th>Date Fin</th>
          <th>Statut</th>
          <th>Sous-traitants</th>
          <th>Certifications</th>
          <th>Pays Donnees</th>
          <th>Plan de Sortie</th>
          <th>Dernier Audit</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody>
        {% for provider in providers %}
        <tr>
          <td><strong>{{ provider.name }}</strong></td>
          <td>{{ provider.ict_function }}</td>
          <td><span class="criticality-{{ provider.criticality }}">{{ provider.criticality|upper }}</span></td>
          <td>{{ provider.contract_start }}</td>
          <td>{{ provider.contract_end }}</td>
          <td><span class="status-{{ provider.status }}">{{ provider.status|upper }}</span></td>
          <td>{% for sub in provider.subcontractors %}{{ sub }}{% if not loop.last %}, {% endif %}{% endfor %}</td>
          <td>{% for cert in provider.certifications %}<span class="cert-badge">{{ cert }}</span>{% endfor %}</td>
          <td>{{ provider.data_location }}</td>
          <td>{% if provider.exit_plan %}Oui{% else %}Non{% endif %}</td>
          <td>{{ provider.last_audit }}</td>
          <td><strong>{{ provider.score }}</strong></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="footer">
    CyberScore &mdash; Registre DORA genere le {{ generated_at }} &mdash; Confidentiel &mdash; A transmettre a l'ACPR sur demande
  </div>
</body>
</html>
